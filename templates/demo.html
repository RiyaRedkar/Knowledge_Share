<!DOCTYPE html>
<html>
<head>
  <title>Knowledge Share â€“ Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    textarea {
      width: 100%;
    }
    .post-box {
      margin-bottom: 20px;
    }
    .adapt-box {
      margin-top: 12px;
      padding: 12px;
      border: 1px solid #ccc;
      background: #fafafa;
    }
    .adapt-result {
      margin-top: 10px;
      padding: 10px;
      background: #f3f3f3;
      border-left: 4px solid #4CAF50;
    }
  </style>
</head>

<body>

<h2>Created Posts</h2>

<!-- ðŸ” SEARCH BAR -->
<form method="GET" action="/search">
  <input
    type="text"
    name="q"
    placeholder="Search practices..."
    value="{{ search_query or '' }}"
  >
  <button type="submit">Search</button>
  <a href="/demo">Clear</a>
</form>

<hr>

{% for post in posts %}
<div class="post-box">

  <!-- ðŸ§  POST CONTENT -->
  <h3>{{ post.practice_name }}</h3>
  <p>{{ post.description }}</p>

  <p>
    <b>Validation Score:</b>
    {{ post.validation_score if post.validation_score is defined else post.verification_score }}
  </p>

  <!-- ACTIONS -->
  <form method="POST" action="/validate/{{ post.post_id }}">
    <button type="submit">Run Validation</button>
  </form>

  <form method="GET" action="/comments/{{ post.post_id }}">
    <button type="submit">View / Add Comments</button>
  </form>

  <!-- ðŸ¤– ADAPTATION -->
  <div class="adapt-box">
    <h4>Personalize for Your Context</h4>

    <form method="POST" action="/adapt/{{ post.post_id }}">
      <textarea
        name="user_context"
        rows="3"
        placeholder="Describe your space, location, constraints..."
        required
      ></textarea>
      <br>
      <button type="submit">Adapt This Practice</button>
    </form>

    <!-- âœ… SHOW ADAPTATION ONLY FOR THIS POST -->
    {% if adapted_post_id == post.post_id %}
      <div class="adapt-result">
        <h4>Adapted Solution</h4>

        <p><b>Solution:</b> {{ adapted_result.adapted_solution }}</p>

        {% if adapted_result.how_to_apply %}
          <h5>How to Apply</h5>
          <ul>
            {% for step in adapted_result.how_to_apply %}
              <li>{{ step }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if adapted_result.materials_needed %}
          <h5>Materials Needed</h5>
          <ul>
            {% for item in adapted_result.materials_needed %}
              <li>{{ item }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if adapted_result.warnings %}
          <h5>Warnings</h5>
          <ul>
            {% for warn in adapted_result.warnings %}
              <li>{{ warn }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endif %}

  </div>

  <hr>
</div>
{% endfor %}

</body>
</html>
